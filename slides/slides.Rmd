---
title: 'Stat159 Final Project'
author: "Aoyi Shan, Yukun He, Siyu Chen, Shuotong Wu"
date: "11/20/2016"
output: 
  ioslides_presentation:
    incremental: true
---

## Introduction

- The client of our consulting project: a group of school administrators
- Consulting Topic: 
  - To explore the differences between similar schools in terms of demographics and programs offered and how those differences contribute to school competitiveness 
- 

and our data analysis is aimed to provide them with suggestions regarding what factors should they focus on and how to maximize their returns on investment in order to improve their school competitiveness. 

## Data Cleaning

- 1.Select the following columns: 
  Number of undergraduate student(UGDS), admission rate(ADM_RATE), average cost of attendence, tuition and fees(COSTT4_A), Mean and median earnings(MD_EARN_WNE_P10), completion rates for first-time, full-time students(C100_4) , percent of undergraduates receiving federal loans(PCTFLOAN), minority ratio(calculated by the sum of percentages of different minorty groups), students applied(calculated by dividing number of undergrads by admission rate)

## Data Cleaning
- 2.Remove all the rows which contains at least one null values
- 3.Divide the schools by regions: west, midwest, northeat and south and divide by whether the schools is in major cities or not
- 4.Eliminate columns which contains PrivacySuppresed

## Categorization:
- Data is first divided by region then further grouped by whether it's in major cities or not
- Categorize data into 8 groups: 
  West schools in Major city, West schools not in major city, Midwest schools in Major city, Midwest schools not in major city, North schools in Major city, North schools not in major city, South schools in Major city, South schools not in major city
     
## Train Test Split & Method Determination:
- 1579 valid entries remained after data cleaning
- Use 3:1 train test split ratio for the overall dataset and try to find the best regression method
- Take log of STU_APPLIED, MD_EARN_WNE_P10, PCTFLOAN, C100_4, COSTT4_A to perform regression and replace 0 in those columns with 0.001 

## Cluster Statistics

```{r results= 'asis', echo = FALSE}
library(xtable)
library(Matrix)
options(xtable.comment = FALSE,
        xtable.table.placement = "H")
load("../data/data-outputs/eda-outputs/cluster-eda-stats.RData")
foodata = t(cluster_eda_stats[,2:ncol(cluster_eda_stats)])
foodata = foodata[, c(1,2,6,10,14,18)]
colnames(foodata)[5] = "LOAN_avg" 
print(xtable(foodata, caption = 'Cluster Statistics'), comment = FALSE, type = "HTML")
```

## ANOVA Test
```{r results= 'asis', echo = FALSE}
load("../data/data-outputs/anova.RData")
print(xtable(summary(aov_result), caption = 'ANOVA Test Result'), comment = FALSE, type = "HTML")
```

## Model Building Process

- Use 10-fold cross validation in building each regression model
- Use the overall train set to fit the model
- Calculate MSE in the overall test set 
- Fit the model we select to the entire data set
     
## Analysis | OLS Regression

Students applied = Median_Earning + Completion_rate + Percentage_with_Student_Loans + Major_City + Minority_Ratio + West + Midwest + Northeast

## 6 main variables in the regression
- Median_Earning: Student's median earning 10 years after graduation
- Completion_rate: Percentage of students graduated within 4 years
- Percentage_with_Student_Loans: Percentage of students with Student Loans
- Major_City: Whether the institution is located near a major city or countryside
- Minority_Ratio: The ratio of non-white students to the total population
- West, Midwest, East: Region dummy variables

## OLS Regression Model

```{r results= 'asis', echo = FALSE}
load("../data/regression-data/overall-ols-model.RData")
print(xtable(summary(ols_full_fit), caption = 'OLS Regression Output for the Full Data Set',digits = c(0,3,3,3,3)), comment = FALSE, type = "HTML")
```

## Comparing 5 Regression Models

```{r results= 'asis', echo = FALSE}
load("../data/regression-data/overall-ridge-model.RData")
load("../data/regression-data/overall-lasso-model.RData")
load("../data/regression-data/overall-pcr-model.RData")
load("../data/regression-data/overall-plsr-model.RData")

reg_coef_mat = cbind(ols_fitted_coef, as.numeric(ridge_fitted_coef), as.numeric(lasso_fitted_coef), c(NA,pcr_fitted_coef), c(NA,plsr_fitted_coef))
reg_coef_mat = reg_coef_mat[-1,]
colnames(reg_coef_mat) = c("ols", "ridge", "lasso", "pcr", "plsr")
print(xtable(reg_coef_mat, caption = 'Regression Coefficients for 5 Regression Methods', digits = c(0,5,5,5,5,5)), comment = FALSE)

MSE_val = as.matrix(c("ols" = MSE_ols, "ridge" = MSE_ridge, "lasso" = MSE_lasso, "pcr" = MSE_pcr, "plsr" = MSE_plsr))
colnames(MSE_val) = "MSE"
print(xtable(MSE_val, caption = 'MSE of 5 Regression Methods', digits = 5), comment = FALSE)

par(mfrow = c(1,1))
plot(reg_coef_mat[,1], xlab = "Coefficients", ylab = "Value", main = "Trend Lines of Coefficients for Different Regression Models")
lines(reg_coef_mat[,1])
points(reg_coef_mat[,2],col= "blue")
lines(reg_coef_mat[,2],col = "blue")
points(reg_coef_mat[,3], col = "red")
lines(reg_coef_mat[,3],col = "red")
points(reg_coef_mat[,4], col = "green")
lines(reg_coef_mat[,4],col = "green")
points(reg_coef_mat[,5], col = "yellow")
lines(reg_coef_mat[,5],col = "yellow")
legend(7.3,3,c('OLS','Ridge','Lasso','PCR','PLSR'), lty = c(1,1,1,1,1), lwd = c(2.5,2.5,2.5,2.5,2.5), col = c("black","blue","red","green","yellow"),merge = T)
abline(h = 0, lty = 3)
```
