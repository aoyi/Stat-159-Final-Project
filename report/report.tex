\documentclass{article}

\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[margin=0.75in]{geometry}
\usepackage{float}

\title{Final Project Report}
\author{Aoyi Shan, Siyu Chen, Yukun He, Shuotong Wu}
\date{December 4th, 2016}

\usepackage{Sweave}
\begin{document}

\input{report-concordance}

\maketitle

\section{Introduction}

In this project, our objective is to explore the differences between similar schools in terms of demographics and programs offered and how those differences contribute to school competitiveness based on the dataset available on College Scorecard https://collegescorecard.ed.gov/data/. The client of our consulting project is a group of school administrators, and our data analysis is aimed to provide them with suggestions regarding what factors should they focus on and how to maximize their returns on investment in order to improve their school competitiveness. The requirement for this project can be found at https://github.com/ucb-stat159/stat159-fall-2016/blob/master/projects/proj03/stat159-final-project.pdf.

\section{Data}





\section{Analysis}

\subsection{Exploratory Data Analysis (EDA)}

The first step of conducting analysis is to understand the data by conducting exploratory data analysis. To conduct the EDA, we obtained descriptive statistics and summaries of all variables. For the quantitative variables, we wrote a function called output\_quantitative\_stats() to get minimum, maximum, range, median, first and third quartiles, IQR, Mean and Sd of all the quantitative variables including UGDS for all races, UGDS, ADM\_RATE, COSTT4\_A, MD\_EARN, C100\_4, PCTFLOAN, CIP\_SUM, MINORATIO and STU\_APPLIED.

Similarly, we wrote a function called output\_qualitative\_stats() to generate a table with both the frequency and the relative frequency of the qualitative variables including WEST,  MIDWEST, NORTHEAST, SOUTH, MAJOR\_CITY, MINOQ1, MINOQ2, MINOQ3, and MINOQ4. To understand the data better, we also want to generate some plots to visualize the data. We wrote the functions histogram\_generator() and boxplot\_generator() to generate histograms and boxplots of the quantitative variables and condition\_boxplot\_generator() to generate conditional boxplots between STU\_APPLIED and the qualitative variables. To study the association between STU\_APPLIED and the rest of predictors, we also obtained the correlation matrix of all quantitative variables using function cor(), the scatterplot matrix using function pairs(), the ANOVA between STU\_APPLIED and all the qualitative variables using function aov().

Then, we divide our dataset into 8 separate clusters according to region and its proximity to major cities. In order to develop strategies to improve competitiveness for each cluster, we first tabulate some key statistics for each cluster.

\begin{Schunk}
\begin{Soutput}
\begin{table}[ht]
\centering
\begin{tabular}{rrrrrrrrr}
  \hline
 & WM & WN & MM & MN & NM & NN & SM & SN \\ 
  \hline
Size & 117.00 & 95.00 & 149.00 & 261.00 & 127.00 & 292.00 & 230.00 & 284.00 \\ 
  STU\_APP\_avg & 16505.36 & 11347.99 & 8033.18 & 6553.14 & 13623.85 & 7271.64 & 11538.00 & 7786.49 \\ 
  STU\_APP\_sd & 28415.84 & 20056.26 & 13990.95 & 9733.35 & 22181.73 & 11061.65 & 16745.93 & 16166.58 \\ 
  STU\_APP\_min & 112.01 & 122.68 & 106.29 & 105.00 & 172.26 & 138.13 & 170.00 & 280.88 \\ 
  STU\_APP\_max & 169325.84 & 137878.19 & 87521.71 & 66552.25 & 121409.40 & 100035.24 & 105381.98 & 221057.35 \\ 
  MD\_EARN\_avg & 43744.44 & 43400.00 & 40934.23 & 40521.84 & 47893.70 & 45403.42 & 40241.30 & 37694.37 \\ 
  MD\_EARN\_sd & 10596.73 & 11062.87 & 8391.54 & 7613.28 & 15545.28 & 11779.51 & 8518.42 & 7305.08 \\ 
  MD\_EARN\_min & 22100.00 & 22000.00 & 22800.00 & 18500.00 & 19300.00 & 12000.00 & 23500.00 & 19900.00 \\ 
  MD\_EARN\_max & 79400.00 & 86000.00 & 69300.00 & 79200.00 & 113400.00 & 118800.00 & 76700.00 & 64000.00 \\ 
  C100\_4\_avg & 0.38 & 0.35 & 0.36 & 0.39 & 0.49 & 0.46 & 0.32 & 0.32 \\ 
  C100\_4\_sd & 0.24 & 0.22 & 0.20 & 0.20 & 0.23 & 0.22 & 0.21 & 0.19 \\ 
  C100\_4\_min & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 \\ 
  C100\_4\_max & 1.00 & 0.90 & 1.00 & 1.00 & 0.91 & 0.90 & 1.00 & 1.00 \\ 
  PCTFLOAN\_avg & 0.56 & 0.52 & 0.65 & 0.62 & 0.57 & 0.61 & 0.60 & 0.62 \\ 
  PCTFLOAN\_sd & 0.17 & 0.18 & 0.15 & 0.15 & 0.19 & 0.19 & 0.17 & 0.16 \\ 
  PCTFLOAN\_min & 0.19 & 0.00 & 0.19 & 0.00 & 0.04 & 0.00 & 0.14 & 0.15 \\ 
  PCTFLOAN\_max & 0.92 & 0.93 & 0.94 & 0.93 & 0.92 & 0.92 & 0.97 & 0.98 \\ 
  MINORITY\_avg & 0.54 & 0.46 & 0.33 & 0.27 & 0.45 & 0.35 & 0.53 & 0.42 \\ 
  MINORITY\_sd & 0.20 & 0.19 & 0.16 & 0.14 & 0.19 & 0.19 & 0.26 & 0.23 \\ 
  MINORITY\_min & 0.13 & 0.15 & 0.05 & 0.00 & 0.06 & 0.00 & 0.11 & 0.03 \\ 
  MINORITY\_max & 0.92 & 0.95 & 0.98 & 1.00 & 0.99 & 0.99 & 1.00 & 1.00 \\ 
   \hline
\end{tabular}
\caption{Cluster Statistics} 
\end{table}
\end{Soutput}
\end{Schunk}

The table contains the number of institutions in each cluster, with Northeast region not located in major city cluster having the most institutions. And since we are interested in predicting students applied by variables such as earnings, graduation rate, minority ratio and percentage of students with loans, we look at the mean for this variable in each cluster first.

ANOVA is designed to test whether there are any statistically significant differences between the means of independent groups. Since our measure of school competitiveness is the number of students applied, we will test whether the means of students applied is different among clusters to gauge whether our clustering criteria makes sense.

\begin{Schunk}
\begin{Soutput}
\begin{table}[ht]
\centering
\begin{tabular}{lrrrrr}
  \hline
 & Df & Sum Sq & Mean Sq & F value & Pr($>$F) \\ 
  \hline
cluster     & 1 & 1923277409.64 & 1923277409.64 & 6.90 & 0.0087 \\ 
  Residuals   & 1553 & 432980783904.29 & 278802822.86 &  &  \\ 
   \hline
\end{tabular}
\caption{ANOVA Test Result} 
\end{table}
\end{Soutput}
\end{Schunk}

The test result shows that we have a p-value smaller than 0.01, which means that we can reject the null hypothesis that the means are the same across all 8 clusters.

Then, after the preliminary EDA, we start to run regression and explore the relationship between variables.

To start with, we run an OLS regression for all variables that we believe have an impact on the number of students applied.

$Students\_applied = Median\_Earning + Completion\_rate + Percentage\_with\_Student\_Loans + Major\_City + Minority\_Ratio + West + Midwest + Northeast$

The dependent variable is the number of students applied for the fall term. It is calculated by dividing people admitted during fall term by the admission rate.

We use 6 main variables as regressors in the regression:

1. Median Earning: Student's median earning 10 years after graduation

2. Completion rate: Percentage of students graduated within 4 years.

3. Percentage with Student Loans: Percentage of students with Student Loans.

4. Major City: Whether the institution is located near a major city or countryside. This dummy variable equals 1 if it is located in a major city, 0 if countryside.

5. Minority Ratio: The ratio of non-white students to the total population.

6. West, Midwest, East: Region dummy variables. We divided all schools into 4 regions and if an institution belongs to a certain region, the corresponding dummy variable will be 1, and others be 0. We drop one dummy variable Northeast in the multiple linear regression to avoid perfect collinearity.

\section{Results}

\begin{Schunk}
\begin{Soutput}
\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & Estimate & Std. Error & t value & Pr($>$$|$t$|$) \\ 
  \hline
(Intercept) & 7646.3936 & 2374.4776 & 3.22 & 0.0013 \\ 
  MD\_EARN\_WNE\_P10 & 0.4786 & 0.0406 & 11.78 & 0.0000 \\ 
  PCTFLOAN & -28506.4649 & 2208.7849 & -12.91 & 0.0000 \\ 
  C100\_4 & 20369.2500 & 2471.9502 & 8.24 & 0.0000 \\ 
  COSTT4\_A & -0.4679 & 0.0383 & -12.21 & 0.0000 \\ 
  MAJOR\_CITY & 2874.5782 & 739.9924 & 3.88 & 0.0001 \\ 
  MINORATIO & 14298.1355 & 1799.6127 & 7.95 & 0.0000 \\ 
  WEST & 998.5487 & 1143.0763 & 0.87 & 0.3825 \\ 
  MIDWEST & 451.4619 & 964.1410 & 0.47 & 0.6397 \\ 
  NORTHEAST & -994.0266 & 973.1039 & -1.02 & 0.3072 \\ 
   \hline
\end{tabular}
\caption{OLS Regression Output for the Full Data Set} 
\end{table}
\end{Soutput}
\end{Schunk}
  
We noticed that the coefficients are large and each variable comes with different units. In order to make the regression result more interpretable, we take logs of all the quantitative data in the regression. Because we can take log of 0, we replace 0 with 0.0001 in our data set.

In addition, since our data set is large enough, we will first split the set into train set and test set in order to gauge our the performance of our estimated coefficients. We divide the data set according to 3:1 train and test ratio. The train set is used to build the model and test set to calculate the SE.

\begin{Schunk}
\begin{Soutput}
\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & Estimate & Std. Error & t value & Pr($>$$|$t$|$) \\ 
  \hline
(Intercept) & -8.9840 & 1.3240 & -6.79 & 0.0000 \\ 
  ln\_MD\_EARN\_WNE\_P10 & 2.9014 & 0.1211 & 23.96 & 0.0000 \\ 
  ln\_PCTFLOAN & -0.3611 & 0.0372 & -9.71 & 0.0000 \\ 
  ln\_C100\_4 & 0.2781 & 0.0198 & 14.03 & 0.0000 \\ 
  ln\_COSTT4\_A & -1.3325 & 0.0704 & -18.92 & 0.0000 \\ 
  MAJOR\_CITY & 0.1624 & 0.0541 & 3.00 & 0.0027 \\ 
  MINORATIO & 0.9794 & 0.1288 & 7.61 & 0.0000 \\ 
  WEST & -0.1255 & 0.0834 & -1.50 & 0.1326 \\ 
  MIDWEST & -0.0500 & 0.0703 & -0.71 & 0.4775 \\ 
  NORTHEAST & -0.1012 & 0.0710 & -1.43 & 0.1540 \\ 
   \hline
\end{tabular}
\caption{OLS Regression Output After Taking Log} 
\end{table}
\end{Soutput}
\end{Schunk}

Based on the regression output, some findings match with our expectations:

1. For every 1\% increase in median earning 10 years after graduation, we expect the number of students applied to  increase by 2.9\%, holding other variables constant.

2. Every 1\% increase in percentage of students with student loans is associated with a 0.36 decrease in number of students applied, holding other variables constant.

3. If the 4-year completion rate goes up by 1\%, the number of students applied is predicted to increase by 0.28\%, holding other variables constant.

4. If cost of attendence increase by 1\%, on average, we expect the number of students applied decrease by 1.33\%, holding other variables constant.

5. If an institution is located near a major city, the number of students applied will be 0.16\% higher than schools in countryside, holding other variables constant.

6. If the minority ratio increases by 1\%, we predict the number of students applied will increase by -0.98\%.

Those 6 coefficients are all very significant at 1\% significance level with p-value close to 0.

Since OLS is the most common and versatile method, it is our first choice. However, in order to decide which method fits our data better, we also apply Ridge regression (RR), Lasso regression (LR), Principal Components regression (PCR) and Partial Least Squares regression (PLSR) method.

In order to improve our accuracy on predicting MSE, we use cross validation. We used sample() function to get a 3:1 train test split of our original data and for reproducibility purpose, we set.seed() before running the simulation.

For ridge and lasso regression method, we used cv.glmnet() in R package "glmnet" to conduct the ten-fold cross-validation on the train set. We then used the best fitted lambda we found from the train set to build a model and calculate MSE from the test set in order to gauge our performance.

Similarly, for pcr and plsr regression method, we used function pcr() and plsr() in "pls" package to perform the 10-fold cross-validation. We also use the best fitted m from the train set to build the model and obtain the MSE from the test set.


